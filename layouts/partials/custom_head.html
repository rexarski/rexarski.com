<!-- <script>
    MathJax = {
        tex: {
            inlineMath: [
                ['$', '$'],
                ['\\(', '\\)'],
            ],
        },
        svg: {
            fontCache: 'global',
        },
    };
</script>
<script
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script> -->

<script>
    function isPageDark() {
        const body = document.body;
        const mode = localStorage.getItem('darkMode');
        if (body.classList.contains('force-dark')) return true;
        if (body.classList.contains('force-light')) return false;
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    }

    function syncThemeUI() {
        const body = document.body;
        const toggle = document.getElementById('dark-mode-toggle');
        const dark = isPageDark();
        if (dark) {
            body.classList.add('theme-dark');
            toggle.setAttribute('aria-label', 'Switch to light mode');
            toggle.setAttribute('title', 'Switch to light mode');
        } else {
            body.classList.remove('theme-dark');
            toggle.setAttribute('aria-label', 'Switch to dark mode');
            toggle.setAttribute('title', 'Switch to dark mode');
        }
    }

    function toggleDarkMode() {
        const body = document.body;
        body.classList.remove('force-light', 'force-dark');

        const currentMode = localStorage.getItem('darkMode');
        const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (!currentMode || currentMode === 'auto') {
            if (systemPrefersDark) {
                body.classList.add('force-light');
                localStorage.setItem('darkMode', 'force-light');
            } else {
                body.classList.add('force-dark');
                localStorage.setItem('darkMode', 'force-dark');
            }
        } else {
            localStorage.setItem('darkMode', 'auto');
        }
        syncThemeUI();
    }

    document.addEventListener('DOMContentLoaded', function() {
        const savedMode = localStorage.getItem('darkMode');
        const body = document.body;
        body.classList.remove('force-light', 'force-dark');

        if (savedMode === 'force-light') body.classList.add('force-light');
        else if (savedMode === 'force-dark') body.classList.add('force-dark');

        syncThemeUI();

        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
                if (localStorage.getItem('darkMode') === 'auto') syncThemeUI();
            });
        }
    });
</script>
